version: "3.9"

services:
  backend:
    image: inttype/solsol:backend-latest
    build:
      context: ./apps/backend
      dockerfile: Dockerfile
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE}
      SPRING_DATASOURCE_URL: jdbc:mysql://${RDS_HOST}:${RDS_PORT}/${RDS_DB}?useSSL=true&serverTimezone=Asia/Seoul&useUnicode=true&characterEncoding=utf8
      SPRING_DATASOURCE_USERNAME: ${RDS_USER}
      SPRING_DATASOURCE_PASSWORD: ${RDS_PASSWORD}
    expose: ["8080"]
    networks: [ solsol-net ]

  user-web:
    image: inttype/solsol:user-web-latest
    build:
      context: ./apps/frontend/User
      dockerfile: Dockerfile
    expose: ["80"]
    networks: [ solsol-net ]

  admin-web:
    image: inttype/solsol:admin-web-latest
    build:
      context: ./apps/frontend/Admin
      dockerfile: Dockerfile
    expose: ["80"]
    networks: [ solsol-net ]

  gateway:
    image: nginx:alpine
    depends_on: [ backend, user-web, admin-web ]
    ports: [ "80:80" ]
    volumes:
      - ./nginx/gateway.conf:/etc/nginx/conf.d/default.conf:ro
    networks: [ solsol-net ]

networks:
  solsol-net:
    driver: bridge
